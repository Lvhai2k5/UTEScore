<!-- ================= HEADER ================= -->
<header th:fragment="header" class="main-header shadow-sm">
  <nav class="navbar navbar-expand-lg navbar-dark fixed-top py-3 header-gradient">
    <div class="container-fluid px-4">

      <!-- 🔹 Logo -->
      <a class="navbar-brand d-flex align-items-center fw-bold me-4" th:href="@{/customer/home}">
        <img th:src="@{/uploads/Logo.jpg}" alt="UTEScore Logo"
             style="height:50px; width:auto; margin-right:12px; transition:transform 0.4s ease;">
        <span style="font-size:1.6rem; letter-spacing:0.5px;">UTEScore</span>
      </a>

      <!-- 🔹 Nút mobile -->
      <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>

      <!-- 🔹 Menu -->
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav align-items-center">

          <!-- 🏠 Trang chủ -->
          <li class="nav-item mx-3">
            <a class="nav-link fw-semibold fs-5" th:href="@{/customer/home}">🏠 Trang chủ</a>
          </li>

          <!-- ⚙️ Dịch vụ -->
          <li class="nav-item dropdown mx-3 position-relative">
            <a class="nav-link dropdown-toggle fw-semibold fs-5" href="#" id="serviceDropdown">
              ⚙️ Dịch vụ
            </a>
            <ul class="dropdown-menu shadow-sm"
                aria-labelledby="serviceDropdown"
                style="margin-top:12px; margin-left:-40px;">
              <li><a class="dropdown-item fs-6" th:href="@{/customer/pitch-list}">📝 Đặt sân</a></li>
              <li><a class="dropdown-item fs-6" th:href="@{/customer/history}">📅 Lịch sử đặt sân</a></li>
              <li><a class="dropdown-item fs-6" th:href="@{/customer/feedback}">⭐ Góp ý & Đánh giá</a></li>
              <li><a class="dropdown-item fs-6" th:href="@{/customer/account}">👤 Tài khoản</a></li>
              <li><a class="dropdown-item fs-6" th:href="@{/chat/customer}">💌 Chat nhân viên</a></li>
              
              <!-- 🔹 Nút mới: Chat realtime -->
      
              <li><hr class="dropdown-divider"></li>
              <li><a href="#" class="dropdown-item text-danger fw-semibold fs-6" data-logout>🚪 Đăng xuất</a></li>
            </ul>
          </li>

        </ul>
      </div>
    </div>
  </nav>

  <!-- 🌈 STYLE -->
  <style>
    .header-gradient {
      background: linear-gradient(90deg, #16a34a, #3b82f6);
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: background 0.8s ease;
    }
    .header-gradient:hover {
      background: linear-gradient(90deg, #10b981, #2563eb);
    }

    .nav-link {
      color: #fff !important;
      transition: all 0.3s ease;
      position: relative;
    }
    .nav-link:hover {
      color: #ffeb3b !important;
      transform: scale(1.1);
      text-shadow: 0 0 8px rgba(255,255,255,0.7);
    }

    .dropdown-menu {
      border-radius: 12px;
      border: none;
      background: #fff;
      padding: 0.6rem;
      box-shadow: 0 6px 18px rgba(0,0,0,0.15);
      transform: scaleY(0);
      transform-origin: top;
      transition: transform 0.25s ease, opacity 0.25s ease;
      opacity: 0;
    }
    .dropdown-menu.show {
      transform: scaleY(1);
      opacity: 1;
    }

    .dropdown-item {
      color: #374151;
      border-radius: 8px;
      transition: all 0.3s ease;
      padding: 10px 16px;
    }
    .dropdown-item:hover {
      background: linear-gradient(90deg, #e0f2fe, #dbeafe);
      color: #2563eb;
      transform: translateX(6px);
    }

    @media (max-width: 991px) {
      .navbar-collapse {
        background: linear-gradient(180deg, #16a34a, #3b82f6);
        border-radius: 0 0 12px 12px;
        padding: 10px 0;
      }
      .nav-link {
        display: block;
        margin: 8px 0;
      }
    }
  </style>

  <!-- ✅ Bootstrap -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- ✅ JS: chỉ mở khi click -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const dropdownToggles = document.querySelectorAll('.nav-item.dropdown .nav-link');
      dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', (e) => {
          e.preventDefault();
          const menu = toggle.nextElementSibling;
          const isShown = menu.classList.contains('show');

          document.querySelectorAll('.dropdown-menu.show').forEach(m => m.classList.remove('show'));
          if (!isShown) menu.classList.add('show');
        });
      });

      // Ẩn menu khi click ra ngoài
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.nav-item.dropdown')) {
          document.querySelectorAll('.dropdown-menu.show').forEach(m => m.classList.remove('show'));
        }
      });
    });
  </script>

  <!-- ✅ Đăng xuất -->
  <script th:inline="javascript">
    document.addEventListener('click', function (e) {
      const btn = e.target.closest('[data-logout]');
      if (!btn) return;
      e.preventDefault();
      Swal.fire({
        title: 'Bạn có chắc muốn đăng xuất?',
        text: 'Phiên làm việc hiện tại sẽ kết thúc.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Đăng xuất',
        cancelButtonText: 'Hủy'
      }).then((r) => {
        if (r.isConfirmed) {
          window.location.href = /*[[ @{/logout} ]]*/ '/customer/logout';
        }
      });
    });
  </script>
</header>
